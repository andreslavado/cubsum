<!DOCTYPE html>
<html>

<head>
    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
	</style>
</head>

<body>
    <nav class="teal darken-2">
        <div class="nav-wrapper">
            <a href="#" class="brand-logo center">Cube Summation</a>
        </div>
    </nav>
    <div class="row">
        <div class="col s6">
            <div class="row">
                <div class="input-field col s12">
                    <textarea id="inputarea" class="materialize-textarea"></textarea>
                    <label for="inputarea">Input</label>
                </div>
            </div>
        </div>
        <div class="col s6">
            <div id="outputdiv" class="row">
                <div class="input-field col s12">
                    <textarea id="outputarea" class="materialize-textarea"></textarea>
                    <label for="outputarea">Output</label>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s4">
            <a class="waves-effect waves-light teal darken-2 btn" onclick="run()"><i class="material-icons left">play_arrow</i>Run</a>
            <a class="waves-effect waves-light teal darken-2 btn" onclick="clean()"><i class="material-icons left">replay</i>Clear</a>
        </div>
    </div>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript">
        var matrices3D, t, testcases, output;
        // Inicializa variables globales;
        function init() {
            matrices3D = new Array();
            t = 0;
            output = "";
            testcases = undefined;           
        }

        //Limpia datos ingresados
        function clean(){
            init();
            $('#outputarea').val(" ");
            $('#outputarea').trigger('autoresize'); 
            $('#inputarea').val("");
            $('#inputarea').trigger('autoresize');
            $('#inputarea').focus();
        }

        //Función principal, captura los datos de entrada y ejecuta los Test Cases
        function run() {
            init();
            //Divide los datos de entrada en lineas para procesarlas después
            var lines = $('#inputarea').val().split(/\n/);
            //La primer linea representa el valor T
            t = lines[0];
            //Se crean los T casos de prueba (Test Case)
            testcases = createTestCases(t, lines);
            //Se procesan los Test Case, por cada uno se crea una matrix 3D y se aplican las operaciones que corresponden
            for (var i = 0; i < testcases.length; i++) {
                matrices3D.push(generateMatrix(testcases[i].n));
                applyOperations(testcases[i].operations, i);
            }
            //Se muestra la salida tras aplicar las operaciones
            $('#outputarea').val(output);
            $('#outputarea').trigger('autoresize');
            $('#outputarea').focus();

        }
        //Se crean los T casos de prueba
        function createTestCases(t, lines) {
            //Arreglo que contiene los casos de prueba
            var testcases = new Array();
            //Posición de lectura de la linea, arranca en 1 pues la linea 0 equivale a T
            var pos = 1;
            for (var i = 0; i < t; i++) {
                //Se lee la linea que contiene los valores N y M, separados por un espacio
                var nm = lines[pos].split(" ");
                var n = nm[0];
                var m = nm[1];
                //Arreglo que contiene las operaciones
                var operations = new Array();
                pos++;
                //Se leen las operaciones
                for (var j = 0; j < m; j++ , pos++) {
                    operations.push(lines[pos].split(" "));
                }
                //Se crea el caso de prueba con los datos leidos
                var testcase = {
                    n: n,
                    m: m,
                    operations: operations
                };
                //Se almacena el caso de prueba
                testcases.push(testcase);
            }
            return testcases;
        }
        //Crea la matriz 3D
        function generateMatrix(n) {
            var matrix3D = new Array();
            for (x = 0; x < n; x++) {
                matrix3D.push(new Array());
                for (y = 0; y < n; y++) {
                    matrix3D[x].push(new Array());
                    for (z = 0; z < n; z++) {
                        matrix3D[x][y].push(0);
                    }
                }
            }
            return matrix3D;
        }
        //Aplica las operaciones
        function applyOperations(operations, index) {
            for (var i = 0; i < operations.length; i++) {
                var operation = operations[i];

                if (operation[0].toUpperCase() === "UPDATE") {
                    applyUpdate(operation, index);
                } else {
                    if (operation[0].toUpperCase() === "QUERY") {
                        var sum = applyQuery(operation, index);
                        output += sum+"\n";
                    }
                }
            }
        }
        //Aplica operación UPDATE
        function applyUpdate(operation, index) {
            var x = operation[1];
            var y = operation[2];
            var z = operation[3];
            var w = operation[4];
            matrices3D[index][x - 1][y - 1][z - 1] = w;
        }
        //Aplica operación QUERY
        function applyQuery(operation, index) {
            var x1 = operation[1];
            var y1 = operation[2];
            var z1 = operation[3];
            var x2 = operation[4];
            var y2 = operation[5];
            var z2 = operation[6];

            var sum = 0;
            //Se buscan las celdas que esten entre x1, x2, y1, y2, z1 y z2
            for (x = x1; x <= x2; x++) {
                for (y = y1; y <= y2; y++) {
                    for (z = z1; z <= z2; z++) {
                        var value = parseInt(matrices3D[index][x - 1][y - 1][z - 1]);
                        sum += value;        
                    }
                }
            }
            return sum;
        }
    </script>
</body>
</html>